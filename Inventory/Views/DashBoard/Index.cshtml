
@using Inventory.Models
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .table-data {
        vertical-align: middle;
        text-align: center;
        white-space: nowrap;
    }
</style>

<script>

    var message = '@(TempData["OutMessage"] ?? "")';
    if (message !== "") {
        alert(message);
    }
    //legacy part
    //function openModal() {
    //    document.getElementById("dvOverlay").style.display = "";
    //    document.getElementById("dvModal").style.display = "";
    //}

    //function hideModal() {
    //    document.getElementById("dvOverlay").style.display = "none";
    //    document.getElementById("dvModal").style.display = "none";
    //}

    //dynamic part
    function openModal() {
        $('#dvModal').dialog({
            modal: true,
            title: 'Equipment Entry',
            width: 400,
            height: 600
        });
    }
    function UpdateItem(EquipmentId, EquipmentName, Quantity, EntryDate, ReceiveDate) {
        let previousQuantity = Quantity;
        $('#HdnEquipmentId').val(EquipmentId);
        $('#EquipmentName').val(EquipmentName);
        $('#Quantity').val(Quantity);
        $('#EntryDate').val(EntryDate);
        $('#ReceiveDate').val(ReceiveDate);
        $('#submit-btn').val("Update");
        $('#EntryDate').prop('disabled', true);
        $('#Quantity').on('blur', function () {
            var current = parseInt($(this).val());
            if (current < previousQuantity) {
                alert("Quantity cannot be less than previous value: " + previousQuantity);
                $(this).val(previousQuantity);
            }
        });
        $('#dvModal').dialog({
            modal: true,
            title: 'Equipment Update',
            width: 400,
            height: 600,
            close: function () {
                // Reset everything to defaults
                $('#EquipmentName').val('');
                $('#Quantity').val('');
                $('#EntryDate').val('').prop('disabled', false);
                $('#ReceiveDate').val('');
                $('#submit-btn').val('Save');
                previousQuantity = 0;
            }
        });
    }
</script>

<div class="row">
    <div class="col col-sm-6">
        <div style="width: 100%">
            <div style="height: 30px; background:cornsilk;text-align: center; padding: 5px; border-radius: 5px">
                Equipment List
                <input class="btn btn-success" type="button" value="New" style="float: right" onclick="openModal()" />
            </div>
            <div style="max-height: 400px; width: 100%; overflow: auto">
                <table class="table table-hover table-bordered">
                    <thead>
                        <tr class="table-primary">
                            <th></th>
                            <th></th>
                            <th>EquipmentName</th>
                            <th>Quantity</th>
                            <th>Stock</th>
                            <th>EntryDate</th>
                            <th>ReceiveDate</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            List<BaseEquipment> equipmentList = (List<BaseEquipment>)ViewBag.EquipmentList;
                            foreach (BaseEquipment equipment in equipmentList)
                            {
                                <tr>
                                    <td class="table-data"><input class="btn btn-primary" type="button" value="Update" onclick="UpdateItem(@equipment.EquipmentId, '@equipment.EquipmentName', @equipment.Quantity, '@equipment.EntryDate.ToString("yyyy-MM-dd")', '@equipment.ReceiveDate.ToString("yyyy-MM-dd")')" /></td>
                                    <td class="table-data"><input class="btn btn-danger" type="button" value="Delete"/></td>
                                    <td class="table-data">@equipment.EquipmentName</td>
                                    <td class="table-data">@equipment.Quantity</td>
                                    <td class="table-data">@equipment.Stock</td>
                                    <td class="table-data">@equipment.EntryDate</td>
                                    <td class="table-data">@equipment.ReceiveDate</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col col-sm-6">
        <div style="width: 100%">
            <div style="height: 30px; background: cornsilk; text-align: center; padding: 5px; border-radius: 5px ">
                Caption 2
            </div>
            <div style="max-height: 400px; width: 100%; overflow: auto">List 2</div>
        </div>
    </div>
</div>

@Html.Partial("_PartialEquipmentEntry")